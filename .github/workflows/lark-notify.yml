name: Notify to Lark on Push

on:
  push:
    branches:
      - main

jobs:
  notify:
    runs-on: ubuntu-latest

    env:
      ENVIRONMENT: production
      REPO_URL: ${{ github.repositoryUrl }}

    steps:
      - name: Notify Lark
        run: |
          curl -X POST https://open.larksuite.com/open-apis/bot/v2/hook/88fccfea-8fad-47d9-99a9-44d214785fff \
            -H "Content-Type: application/json" \
            -d '{
              "msg_type": "interactive",
              "card": {
                "header": {
                  "title": {
                    "tag": "plain_text",
                    "content": "ðŸš€ Deployment Notification"
                  },
                  "template": "blue"
                },
                "elements": [
                  {
                    "tag": "div",
                    "fields": [
                      {
                        "is_short": true,
                        "text": {
                          "tag": "lark_md",
                          "content": "**Branch:** <font color=\"green\">`${{ github.ref_name }}`</font>"
                        }
                      },
                      {
                        "is_short": true,
                        "text": {
                          "tag": "lark_md",
                          "content": "**Deployer:** `${{ github.actor }}`"
                        }
                      }
                    ]
                  },
                  {
                    "tag": "div",
                    "fields": [
                      {
                        "is_short": true,
                        "text": {
                          "tag": "lark_md",
                          "content": "**Environment:** <font color=\"green\">`${{ env.ENVIRONMENT }}`</font>"
                        }
                      },
                      {
                        "is_short": true,
                        "text": {
                          "tag": "lark_md",
                          "content": "**Commit:** [View Commit](${{ github.event.head_commit.url }})"
                        }
                      }
                    ]
                  },
                  {
                    "tag": "div",
                    "text": {
                      "tag": "lark_md",
                      "content": "**Commit Messages** ðŸ˜Š\n> ${{ github.event.head_commit.message }}"
                    }
                  },
                  {
                    "tag": "action",
                    "actions": [
                      {
                        "tag": "button",
                        "text": {
                          "tag": "plain_text",
                          "content": "View Repo"
                        },
                        "type": "default",
                        "url": "${{ env.REPO_URL }}"
                      }
                    ]
                  }
                ]
              }
            }'
